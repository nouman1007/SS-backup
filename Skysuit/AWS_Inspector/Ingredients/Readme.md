# Deploy & Configure AWS Inspector to Scan Instances

The designed solution involves setting up the AWS Inspector  automation solution in each AWS account through AWS CloudFormation StackSets in a Master account.

## **AWS Services Used In Solution**

- AWS  Inspector

- AWS Security Hub

  

## Amazon Inspector

Amazon Inspector tests the network accessibility of your Amazon EC2 instances and the security state of your applications that run on those instances. Amazon Inspector assesses applications for exposure, vulnerabilities, and deviations from best practices. After performing an assessment, Amazon Inspector produces a detailed list of security findings that is organized by level of severity.

**Amazon Inspector agent**

A software agent that you can install on the EC2 instances that are included in the assessment target. The agent collects a wide set of configuration data. 

**Assessment target**

A collection of AWS resources that work together as a unit to help you accomplish your business goals. Amazon Inspector evaluates the security state of the resources that constitute the assessment target.

**Note**

To create an Amazon Inspector assessment target, you must first tag your EC2 instances with key-value pairs of your choice. Next, you can create a view of these tagged EC2 instances that have common keys or common values.

**Assessment template**

A configuration that is used during your assessment run. The template includes the following:

·    Rules packages that Amazon Inspector uses to evaluate your assessment target

·    Amazon SNS topics that you want Amazon Inspector to send notifications to about assessment run states and findings

·    Tags (key-value pairs) that you can assign to findings that are generated by the assessment run

·    The duration of the assessment run

**Assessment run**

.  During an assessment run, Amazon Inspector monitors, collects, and analyzes configuration data (telemetry) from resources within the specified target. Next, Amazon Inspector analyzes the data and compares it against a set of security rules packages that are specified in the assessment template used during the assessment run. 

.  A completed assessment run produces a list of findings, which are potential security issues of various levels of severity. 

**Finding**

A potential security issue that Amazon Inspector discovers during an assessment run of the specified target. Findings are displayed in the Amazon Inspector console or retrieved through the API. They contain both a detailed description of the security issue and a recommendation on how to fix it.

**Rule**

In the context of Amazon Inspector, a security check performed during an assessment run. When a rule detects a potential security issue, Amazon Inspector generates a finding that describes the issue.

**Rules package**

A rules package corresponds to a security goal that you might have. You can specify your security goal by selecting the appropriate rules package when you create an Amazon Inspector assessment template.

## Deployment



1. In the master account, an AWS CloudFormation stack set is used to create the resource group, assessment target, configure the assessment template and run that assessment template (through lambda ) .

2. AWS Security Hub Multiaccount Scripts (These scripts automate the process of enabling and disabling AWS Security Hub simultaneously across a group of AWS accounts that are in your control. (Note, that you can have one master account and up to a 1000 member accounts) 

   


| ***SrNo.\*** | ***File\***              | ***Description\***                                           | ***Location\***                        |
| ------------ | ------------------------ | ------------------------------------------------------------ | -------------------------------------- |
| 1            | inspector_deployment.yml | Create resource group, assessment target, configure the assessment template and run that assessment template. | AWSInspector\CloudFormation  Templates |

​    

## **Deployment steps**

1. Steps for Master Account
   - Deploy **inspetor_deployment.yml** through stack set in desire account. It will create  resources i.e   resource group, assessment target, configure the assessment template and run that assessment template.

     **Parameters in Template**

     | Parameter               | Description                                   | Allowed values/Default |
     | ----------------------- | --------------------------------------------- | ---------------------- |
     | pAssessmentTemplateName | The name of the Assessment Template           | Eq-AssessmentTemplate  |
     | pAssessmentTargetName   | The name of the Assessment Target             | Eq-AssessmentTarget    |
     | pResourceGroupTagsKey   | The Value name of the tag of the resource     | Patch Group            |
     | pResourceGroupTagsValue | The key name of the tag of the resource       | Dev                    |
     | pDurationInSeconds      | The duration of the assessment run in seconds | 180                    |
     


   ####  AWS cli packaged command:
   ```
   aws cloudformation package --template-file inspector_deployment.yml --s3-bucket patch-lambda-code --output-template-file inspector_deployment_packaged.yml
   ```

   


## AWS Security Hub Multiaccount Scripts

https://github.com/awslabs/aws-securityhub-multiaccount-scripts